# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Описание архитектуры проекта

В работе используется шаблон проектирования пользовательского интерфейса Model-View-Presenter (MVP). Данный подход позволяет создавать абстракцию представления. Для этого выделяется интерфейс представления с определенным набором свойств и методов. Презентер, в свою очередь, получает ссылку на реализацию интерфейса, подписывается на события представления и по запросу изменяет модель. Каждое представление реализует соответствующий интерфейс. Интерфейс представления определяет набор функций и событий, необходимых для взаимодействия с пользователем. Все события представления передаются для обработки в презентер и практически никогда не обрабатываются логикой представления. Презентер (`./index.ts`) отвечает за взаимодействие данных (`./model/*`) и представлений (`./view/*`) описывая логику приложения. Взаимодействие происходит через события. Модели инициируют события, слушатели событий в Present'ере передают данные компонентам отображения.

Также в работе используется шаблон проектирования брокер событий (EventEmitter). Он дает возможность с любого места в приложении сообщить о каком-либо событии. Все, кто был подписан на это событие сразу же об этом узнают и как-то отреагируют.

## Описание классов проекта

### Базовые классы

#### `Api`

Класс для отправки HTTP-запросов и получения HTTP-ответов от ресурса, определяемого URI.

Свойства и методы класса:

- `baseUrl`: базовый `URL` приложения;
- `options`: параметры соединения;
- `constructor(baseUrl: string, options: RequestInit = {})`: инициализирует новый экземпляр класса `Api` с указанными базовым `URL` и параметрами соединения;
- `get`: отправляет запрос `GET` согласно указанному универсальному коду ресурса (`URI`);
- `post`: отправляет запрос `POST` по указанному универсальному коду ресурса (`URI`);
- `handleResponse`: обрабатывает код ответа от сервера, возвращает либо распарсенные данные, либо ошибку.

#### `Components`

Абстрактный класс определяющий создание компонентов пользовательского интерфейса.

Свойства и методы класса:

- `constructor(container: HTMLElement)`: инициализирует новый экземпляр класса `Components` c указанным контейнером в который будет помещен компонент;
- `toggleClass`: переключает класс элемента;
- `setText`: устанавливает текстовое содержимое для элемента;
- `setDisabled`: меняет статус блокировки для элемента;
- `setHidden`: скрывает элемент;
- `setVisible`: отображает элемент;
- `setImage`: устанавливает изображение с альтернативным тестом для элемента;
- `render`: рендерит компонент.

#### `EventEmitter`

Класс для управления подписками на события.

Свойства и методы класса:

- `_events`: ;
- `on`: устанавливает обработчик для определенного типа событий;
- `off`: снимает установленный обработчик с события;
- `emit`: инициирует событие с данными;
- `onAll`: подписывает на все события;
- `offAll`: сбрасывает все зарегистрированные обработчики для всех событий;
- `trigger`: создаёт коллбэк-триггер, генерирующий событие при вызове.

#### `Model`

Абстрактный класс определяющий конструктор всех моделей приложения.

Свойства и методы класса:

- `emitChanges`: сообщает об изменении данных.

### Общие классы

#### `Form`

Класс реализующий компонент с формой.

Свойства и методы класса:

- `_submit`: элемент кнопки сабмита модального окна;
- `_errors`: контейнер с сообщениями об ошибках;
- `constructor(protected container: HTMLFormElement, protected _events: IEvents)`: инициализирует новый экземпляр класса `Form` c указанным контейнером с формой и брокером событий;
- `valid(value: boolean)`: дизейблит кнопку сабмита формы;
- `errors(value: string)`: меняет содержимое компонента с ошибками;
- `onInputChange(field: keyof T, value: string)`: инициирует событие `${this.container.name}.${String(field)}:change`;
- `render(state: Partial<T> & IFormState)`: рендерит компонент формы.

#### `Modal`

Класс реализующий компонент модального окна.

Свойства и методы класса:

- `_closeButton`: элемент кнопки закрытия модального окна;
- `_content`: элемент с содержимым модального окна;
- `constructor(container: HTMLElement, protected events: IEvents)`: инициализирует новый экземпляр класса Modal c указанным контейнером с модальным окном и брокером событий;
- `content(value: HTMLElement)`: устанавливает содержимое окна;
- `open()` - открывает модальное окно, инициирует событие `modal:open`;
- `close()` - закрывает модальное окно, инициирует событие `modal:close`;
- `render(data: IModalData)` - рендерит компонент модального окна.

#### `Success`

Класс определяющий отображение успешного размещения заказа.

Свойства и методы класса:

- `_total`: элемент с суммой заказа;
- `_close`: элемент кнопки закрытия окна;
- `constructor(container: HTMLElement, actions: ISuccessActions)`: инициализирует новый экземпляр класса Success c указанным контейнером с модальным окном и обработчиком события `click` на элементе;
- `total(total: string)`: устанавливает сумму заказа.

### Модели данных

#### BasketModel

Класс для хранения данных корзины и работы с ними.

Свойства и методы класса:

- `items: IProduct[]`: массив позиций с товаром;
- `price: number`: стоимость всей корзины;
- `constructor(protected data: Partial<IProduct>, protected events: IEvents`: инициализирует новый экземпляр класса BasketModel c частью данных интерфейса `IProduct` и брокером событий;
- `items(item: IProduct[])`: устанавливает значения для массива позиций с товаром в корзине;
- `items()`: забирает список позиций с товаром в корзине;
- `isInBasket(item: IProduct)`: проверяет наличие позиции с товаром в корзине;
- `addToBasket(item: IProduct)`: добавляет позицию с товаром в корзину, инициирует событие `basket:change`;
- `deleteFromBasket(item: IProduct)`: удаляет позицию с товаром из корзины, инициирует событие `basket:change`;
- `clearBasket()`: очищает корзину, инициирует событие `basket:change`.

#### CatalogModel

Класс для хранения данных каталога с товарами и работы с ним.

Свойства и методы класса:

- `_items: IProduct[]`: массив позиций с товаром;
- `selectedItem: IProduct`: ;
- `constructor(protected data: Partial<IProduct>, protected events: IEvents)`: инициализирует новый экземпляр класса `CatalogModel` c частью данных интерфейса `IProduct` и брокером событий;
- `items(items: IProduct[])`: устанавливает значения для массива позиций с товаром, инициирует событие `items:change`;
- `items()`: забирает массив позиций с товаром;
- `preview(item: IProduct)`: устанавливает значения для товара, инициирует событие `preview:change`.

#### OrderModel

Класс для хранения данных заказа и работы с ними.

Свойства и методы класса:

- `order: IOrder`: данные заказа;
- `formErrors: TFormErrors`: данные валидации форм;
- `constructor(protected data: Partial<IOrder>, protected events: IEvents)`: инициализирует новый экземпляр класса `OrderModel` c частью данных интерфейса `IOrder` и брокером событий;
- `setOrderAddress(field: keyof TOrderForm, value: string)`: устанавливает данные заказа (адрес);
- `validateOrderAddressAndPayment()`: проверяет корректность заполнения полей адрес и метод оплаты;
- `setOrderContacts(field: keyof TContactForm, value: string)`: устанавливает данные заказа (email и номер телефона);
- `validateContacts()`: проверяет корректность заполнения полей email и номер телефона.

### Компоненты

#### Basket

Класс реализующий корзину.

Свойства и методы класса:

- `_list`: элемент содержимого корзины;
- `_price`: элемент суммы товаров в корзине;
- `_button`: элемент кнопки в корзине;
- `constructor(readonly container: HTMLElement, protected events: EventEmitter)`: инициализирует новый экземпляр класса Card c указанным контейнером с модальным окном и брокером событий;
- `items(items: HTMLElement[])`: выставляет содержимое в корзине;
- `price(price: number)`: выставляет значение суммы товаров в корзине;
- `setIndexes()`: отрисовывает индексы позиций товара в корзине;
- `toggleButton(state: boolean)`: меняет состояние кнопки в корзине.

#### Card

Класс реализующий карточку товара.

Свойства и методы класса:

- `_title`: элемент заголовка товара;
- `_image`: элемент картинки товара;
- `_price`: элемент цены товара;
- `_category`: элемент категории товара;
- `_description`: элемент описания товара;
- `_button`: элемент кнопки карточки с товаром;
- `constructor(readonly container: HTMLElement, actions?: IActions)`: инициализирует новый экземпляр класса Card c указанным контейнером с модальным окном и обработчиком события `click` на элементе;
- `id(value: string)`: устанавливает идентификатор товара;
- `id()`: забирает идентификатор товара;
- `title(value: string)`: устанавливает заголовок товара;
- `title()`: забирает заголовок товара;
- `description(value: string)`: устанавливает описание товара;
- `button(value: string)`: устанавливает текст на кнопке на карточке товара;
- `price(value: string)`: устанавливает цену товара;
- `price()`: забирает цену товара;
- `category(value: string)`: устанавливает категорию товара;
- `category()`: забирает категорию товара;
- `image(src: string)`: устанавливает изображение товара.

#### Order

Класс реализующий форму заказа.

Свойства и методы класса:

- `_paymentButtons`: элемент кнопки выбора метода оплаты;
- `_button`: элемент кнопки сабмита;
- `constructor(container: HTMLFormElement, events: IEvents)`: инициализирует новый экземпляр класса Order c указанным контейнером с формой и брокером событий;
- `payment(value: string)`: меняет метод оплаты;
- `address(value: string)`: меняет содержимое поля `address` в форме;
- `email(value: string)`: меняет содержимое поля `email` в форме;
- `phone(value: string)`: меняет содержимое поля `phone` в форме;
- `onPaymentMethodSelect`: выставляет метод оплаты, инициирует событие `order:payment:change`.

#### Page

Класс реализующий главную страницу приложения.

Свойства и методы класса:

- `_counter`: элемент счетчика корзины на странице;
- `_catalog`: элемент каталога на странице;
- `_wrapper`: элемент обертки главной страницы;
- `_basket`: элемент корзины на странице;
- `constructor(container: HTMLElement, protected events: IEvents)`: инициализирует новый экземпляр класса Page c указанным контейнером с телом документа и брокером событий;
- `counter(value: number)`: меняет счетчик;
- `catalog(items: HTMLElement[])`: меняет каталог;
- `locked(value: boolean)`: меняет класс обертки главной страницы.

### Компоненты коммуникации

#### MagazinusApi

Специальный компонент для взаимодействия с `API` магазина.

Свойства и методы класса:

- `cdn`: `URL` до контента (содержимое каталога);
- `constructor(cdn: string, baseUrl: string, options?: RequestInit)`: инициализирует новый экземпляр класса MagazinusApi c указанными `URL` до контента, базовым `URL` и опционально с параметрами соединения;
- `getProductList(): Promise<IProduct[]>`: получение списка товаров;
- `placeOrder(order: IOrder): Promise<IOrderResult>`: размещение заказа.

### Типы данных

См. [/src/types/index.ts](https://github.com/athdevtvs/web-larek-frontend/blob/main/src/types/index.ts)
